
# Table of Contents

1. [API для прогноза заказов в ресторанах](#api-для-прогноза-заказов-в-ресторанах)
2. [Эндпоинты](#эндпоинты)
   1. [/predict](#1-predict-post)
   2. [/upload](#2-upload-post)
   3. [/areas](#3-areas-get)
   4. [/docs](#4-docs-get)
3. [Запуск приложения](#запуск-приложения)
   1. [Вариант 1: Локальная установка](#вариант-1-локальная-установка)
   2. [Вариант 2: Использование Docker](#вариант-2-использование-docker)
4. [Проблемы при разработке](#проблемы-при-разработке)
   1. [Работа с кешем](#1-работа-с-кешем)
   2. [Обучение моделей для разных зон](#2-обучение-моделей-для-разных-зон)
   3. [Обработка файлов](#3-обработка-файлов)
   4. [Управление зависимостями](#4-управление-зависимостями)
   5. [Оптимизация производительности](#5-оптимизация-производительности)

# API для прогноза заказов в ресторанах

Сервис на основе FastAPI для предсказания заказов ресторанов, учитывая элементы меню, типы заказов и конкретные места.

## Эндпоинты

### 1. `/predict` [POST]
- **Описание**: Получение прогноза заказов для конкретного места и даты.
- **Запрос**:
  ```json
  {
      "area": "НазваниеМеста",
      "target_date": "ГГГГ-ММ-ДД"
  }
  ```
- **Ответ**:
  ```json
  {
      "predictions": [
          {
              "Category": "НазваниеКатегории",
              "Item": "НазваниеЕды",
              "Type_of_Order": "Навынос/ВнутриЗала",
              "Predicted_Orders": 50
          }
      ],
      "total_orders": 100,
      "area": "НазваниеМеста",
      "target_date": "ГГГГ-ММ-ДД"
  }
  ```

### 2. `/upload` [POST]
- **Описание**: Загрузка нового CSV-файла с данными.
- **Запрос**:
  - Файл с расширением `.csv`, переданный через форму (`multipart/form-data`).
- **Ответ**:
  ```json
  {
      "message": "File uploaded and processed successfully",
      "rows_processed": 1000
  }
  ```
- **Ошибки**:
  - `400`: Если файл не является CSV.
  - `500`: Ошибка при обработке файла.

### 3. `/areas` [GET]
- **Описание**: Получение списка доступных мест из загруженных данных.
- **Ответ**:
  ```json
  {
      "areas": ["Area1", "Area2", "Area3"]
  }
  ```
- **Ошибки**:
  - `404`: Если данные не загружены.

### 4. `/docs` [GET]
- **Описание**: Доступ к Swagger для изучения доступных эндпоинтов.

---

## Запуск приложения

### Вариант 1: Локальная установка
1. Установите зависимости:
    ```bash
    pip install -r requirements.txt
    ```
2. Запустите сервер:
    ```bash
    python -m uvicorn main:app --reload
    ```
3. Доступ к API: `http://localhost:8000`

### Вариант 2: Использование Docker
1. Постройте образ:
    ```bash
    docker build -t fastapi-app .
    ```
2. Запустите контейнер:
    ```bash
    docker run -p 8000:8000 fastapi-app
    ```
3. Доступ к API: `http://localhost:8000`

---

## Проблемы при разработке

### 1. Работа с кешем:
- Ошибки при очистке и обновлении кеша данных.
### 2. Обучение моделей для разных зон:
- Неравномерное распределение данных по зонам и типам заказов.
- Ошибки при создании признаков.
### 3. Обработка файлов:
- Ошибки при загрузке CSV-файлов.
- Проблемы с блокировкой ресурсов при параллельных запросах на загрузку.
### 4. Управление зависимостями:
- Конфликты версий библиотек pandas, scikit-learn, и FastAPI.
### 5. Оптимизация производительности:
- Длительное время загрузки данных из больших CSV-файлов.
- Высокая нагрузка на сервер при предсказаниях для большого диапазона дат.